<style>

body {
  font: 12px 'Lucida Grande', sans-serif;
  margin: 20px;
}

textarea {
  font: 12px Monaco, monospace;
}

</style>
<h2>Input</h2>
<textarea id="input" rows="10" cols="80" spellcheck="false" autofocus></textarea>
<p id="compileTime">Loading...</p>
<h2>Log</h2>
<textarea id="outputLog" rows="10" cols="80" spellcheck="false" readonly></textarea>
<h2>Tree</h2>
<textarea id="outputTree" rows="20" cols="80" spellcheck="false" readonly></textarea>
<script src="../../build/debug/skewc.js"></script>
<script>

function compile() {
  var start = now();
  if (input.value === old) return;
  old = input.value;
  outputLog.value = outputTree.value = '';
  try {
    var source = new Source('<stdin>', input.value);
    var log = new Log();
    var tokens = tokenize(log, source);
    var file = parseFile(log, tokens);
    var program = file !== null ? Node.createProgram([file]) : null;
    if (program) outputTree.value = dump(program); // Dump before the resolver changes stuff
    if (program !== null) Resolver.run(log, program);
    outputLog.value = log.toString();
  } catch (e) {
    outputLog.value = e.stack || e;
  }
  compileTime.innerHTML = 'Compile time: ' + +(now() - start).toFixed(1) + 'ms';
}

var now = this.performance && performance.now
  ? function() { return performance.now(); }
  : function() { return +new Date; };

var old = null;
input.oninput = input.onchange = compile;
compile();

</script>
