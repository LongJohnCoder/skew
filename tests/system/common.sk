import void test(string input, string expected);
import void testJS(string input, string expected);
import void expect(string output, string expected);

export void run(string input, string expected) {
  var options = CompilerOptions();
  options.inputs = { Source("<stdin>", input) };
  var compiler = Compiler();
  var result = compiler.compile(options);
  expect(compiler.log.toString(), expected);
}

export void runJS(string input, string expected) {
  var options = CompilerOptions();
  options.inputs = { Source("<stdin>", input) };
  options.targetFormat = .JS;
  var compiler = Compiler();
  var result = compiler.compile(options);
  if (result.outputs.length > 0) {
    var output = "";
    for (var i = 0; i < result.outputs.length; i++) {
      output += result.outputs.get(i).contents + "\n";
    }
    expect(output, expected);
  } else {
    expect(compiler.log.toString(), expected);
  }
}

export void start() {
  core.calls();
  core.const_();
  core.constructors();
  core.conversions();
  core.cyclic();
  core.enums();
  core.functions();
  core.generics();
  core.lambdas();
  core.let_();
  core.lists();
  core.merging();
  core.modifiers();
  core.objects();
  core.parsing();
  core.statements();
  core.static_();
  core.switch_();
  core.types();
  core.using_();
  core.var_();

  js.expressions();
  js.functions();
  js.inlining();
  js.objects();
  js.statements();
}
