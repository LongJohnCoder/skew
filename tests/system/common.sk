import void test(string input, string expected);
import void testJS(string input, string expected);
import void expect(string output, string expected);

export void run(string input, string expected) {
  var options = CompilerOptions();
  options.inputs = { Source("<stdin>", input) };
  var compiler = Compiler();
  var result = compiler.compile(options);
  expect(compiler.log.toString(), expected);
}

export void runJS(string input, string expected) {
  var options = CompilerOptions();
  options.inputs = { Source("<stdin>", input) };
  options.targetFormat = .JS;
  var compiler = Compiler();
  var result = compiler.compile(options);
  if (result.outputs.length > 0) {
    var output = "";
    for (var i = 0; i < result.outputs.length; i++) {
      output += result.outputs.get(i).contents + "\n";
    }
    expect(output, expected);
  } else {
    expect(compiler.log.toString(), expected);
  }
}
